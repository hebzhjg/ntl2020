# 新Java技术学习笔记



在线绘图工具

https://www.draw.io/



开发工具

IDEA



##	第二章

###	分布式服务架构的演进

高可用，LVS+keepalive

####	1、单体应用

+ 开发速度慢
+ 启动时间长
+ 依赖庞大
+ 等等



#### 2、微服务

+ 易开发、理解和维护（哪里需要，修改，改哪里）
+ 独立的部署和启动
+ 不足
  + 分布式系统-->分布式事务问题（如，用户下单，积分，在不同的服务里，需要同步）
  + 需要管理多个服务（部署复杂，管理和维护，成本较高）
  + 服务治理（哪里服务down了，需要查找解决）



###		微服务核心基础

核心知识：网关、服务发现注册、配置中心、链路追踪、负载均衡器、熔断

####	1、网关：路由转发+过滤器

- /api/v1/pruduct/detial?		商品

- /api/v1/order			订单

- /api/v1/user			用户 

  通过url的规则，进行路由转发（给不同的服务集群）

  过滤器作用，对请求进行验证（登录状态）



#### 2、服务注册发现



####	3、配置中心

每个应用都有一个配置文件

统一管理各个服务的配置

有一个web管理后台



#### 3、链路追踪

当发现整个系统的效率不高时，用来查找和最终那个服务慢了

 分析调用的耗时，进行优化



####	5、负载均衡器

分发负载



####	6、熔断

在系统的流量高峰时如，双11时，集中下单（KPS），要进行保护

如某个服务down后（慢、调不同），不再调用（熔断）



### 常见的微服务框架

consumer：调用方

provider：提供方（被调用）

####	1、dubbo

zookeeprt+dubbo+springmvc/springboot

通讯：rpc

注册：zookeeper/redis

配置：diamond



####	2、springclound

全家桶+轻松嵌入第三方组件（Netflix奈飞）

通讯：http、restful

注册：eruka、consul

配置：config

断路器：hystrix

网关：zuul

追踪：sleuth+zipkin

 

###	微服务电商模块设计

用户服务

	+	用户信息接口
	+	登录接口

商品服务

- 商品服务
- 商品详情

订单服务

+ 我的订单
+ 下单接口



##	第三章 

####	微服务的注册中心

服务的管理、注册列表、心跳监测

微服务应用，机器越来越多，调用方，不用知道接口的网络地址，不用关心服务的状态，都可以从注册中心获得；动态增加服务接口、增加集群节点

主流注册中心：zookeeper、Eureka、consul、etcd



####	分布式应用ACP理论

CAP定理：

在一个分布式系统中，Consistency（一致性）、Availability（可用性）、Partition tolerance（分区容错性），三者不可能同时获得

Consistency一致性：在分布式系统中的所以数据备份，在同一时刻是否同样的值。所有节点在同一时间的数据一致性，节点越多，数据同步越耗时；

Availability可用性：负载过大后，集群整体是否还能响应客户端的读写请求。服务一直可用，而且是正常响应时间；

Partition tolerance分区容错性：高可用性，一个节点崩溃了，不会影响其他节点；如100个节点，挂了几个，不影响服务，越多机器越好；



CAP理论就是说在分布式存储系统中，最多只能实现上面的两点，而由于当前**网络硬件肯定会出现延迟丢包等问题**，所以分区容忍性是我们必需要实现的，所以我们只能在**一致性和可用性**之间进行权衡。

###	分布式系统CAP常见问题

CA：满足，P不能满足；数据同步（为保持一致性C）需要时间，同时全部正常时间内响应（A），那么机器数量就要少（机器越多，需要同步的就越多，所花费的时间就越长），所以P（分区容错）无法保障

CP：满足，A不能满足；数据同步C需要时间，机器数量也很多P，同步数据需要时间，不能满足A；

AP：满足，C不能满足；机器数量多P，确保正常时间内响应，很难确保数据的一致性A；

了解CAP原理的意义，选择注册中心

###	注册中心选择

Zookeeper：CP设计，保障了一致性A，集群搭建的时候，某个节点失败，则会进行（选举leader主节点），当有一半节点不可用时，无法向外提供服务；

--金融行业

Eureka：AP原则，无主从节点，一个节点挂了，自动切换其他节点可以使用，去中心化；（同步数据需要时间）

--电商行业

结论：分布式系统中，P肯定要满足，所以只能在C和A中二选一；没有最好的选择，要根据业务场景进行选择



























